
<div class="table-content-container p-3">
  <div class="flex gap-3 mb-5">
    <p-button styleClass="p-button-sm" i18n-label label="Add repositorie" icon="pi pi-plus">
    </p-button>
    <p-button styleClass="p-button-outlined p-button-secondary p-button-sm" icon="pi pi-spinner" i18n-label label="Update">
    </p-button>
    <p-button styleClass="p-button-outlined p-button-danger p-button-sm" icon="pi pi-stop-circle" i18n-label label="Turn off update">
    </p-button>
  </div>
  <hr>
  <p-table 
      [value]="networksList"
      [paginator]="true"
      [rows]="pageSize"
      [totalRecords]="totalRecords"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10, 25, 50]"
      [lazy]="true"
      [loading]="isLoading"
      (onLazyLoad)="loadContent($event)"
      (onSort)="onSort($event)">

      <ng-template pTemplate="header" >
          <tr>
              <th i18n pSortableColumn="networkID" class="font-bold">
                ID
                <p-sortIcon field="networkID"></p-sortIcon>
            </th>
              <th i18n pSortableColumn="acronym" class="font-bold w-2">
                Acronym
                <p-sortIcon field="acronym"></p-sortIcon>
            </th>
              <th i18n pSortableColumn="name" class="font-bold w-2">
                Repositorie
                <p-sortIcon field="name"></p-sortIcon>
              </th>
              <th i18n pSortableColumn="institution" class="font-bold w-2">
                Institution
                <p-sortIcon field="institution"></p-sortIcon>
              </th>
              <th>
               <span class="font-bold text-center block w-full">Harvesting</span>
              </th>
              <th></th>
          </tr>
          <tr>
            <th>
            </th>
            <th>
              <p-columnFilter type="text" field="acronym" [showMenu]="false">
                <ng-template pTemplate="filter">
                  <input type="text" 
                    pInputText 
                    [(ngModel)]="filter.acronym"
                    placeholder="Acronym"
                    (keydown.enter)="applyFilter()"/>
                </ng-template>
              </p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="name" [showMenu]="false">
                <ng-template pTemplate="filter">
                  <input type="text" 
                    pInputText 
                    [(ngModel)]="filter.name"
                    placeholder="Name"
                    (keydown.enter)="applyFilter()"/>
                </ng-template>
              </p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="institution" [showMenu]="false">
                <ng-template pTemplate="filter">
                  <input type="text" 
                    pInputText 
                    [(ngModel)]="filter.institution"
                    placeholder="Institution"
                    (keydown.enter)="applyFilter()"/>
                </ng-template>
              </p-columnFilter>
            </th>
            <th>
              <div class="flex gap-3">
                <div>Ultima cosecha valida</div> |
                <div>Ultima cosecha</div> 
              </div>
            </th>
            <th></th>
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-networksList>
          <tr>
            <td>{{networksList.networkID}}</td>
            <td>{{networksList.acronym}}</td>
            <td>{{networksList.name}}</td>
            <td class="w-2">{{networksList.institution}}</td>
            <td>
              <div class="flex gap-6">

                <!-- Panel ultima cocecha valida -->
                <div *ngIf="networksList.lgkSnapshotID">
                  <p-overlayPanel #op>
                    <ng-template pTemplate="content">
                      <div>
                        <div>
                          <span class="font-semibold">
                            Cosecha validada
                          </span>
                        </div>
                        <div>
                          <i class="pi pi-clock" style="font-size: 12px"></i>
                          <span class="text-sm ml-1">{{networksList.lgkSnapshotDate}}</span>
                        </div>
                        <div class="gap-1 align-items-center">

                          <div class="flex align-items-center gap-3 mb-3 mt-3">
                            <p-badge value="Size:"></p-badge>
                            <span class="text-xs font-bold">{{networksList.lgkSize}}</span>
                          </div>
                          
                          <div class="flex align-items-center gap-3 mb-3">
                            <p-badge value="Valid:"></p-badge>
                            <span class="text-xs font-bold">{{networksList.lgkValidSize}}</span>
                          </div>
  
                          <div class="flex align-items-center gap-3">
                            <p-badge value="Transformed:"></p-badge>
                            <span class="text-xs font-bold">{{networksList.lgkTransformedSize}}</span>
                          </div>
                          
                        </div>
                      </div>
                    </ng-template>
                  </p-overlayPanel>
                  <p-button 
                    (click)="op.toggle($event)"
                    label="watch"
                    icon="pi pi-eye" 
                    styleClass="p-button-outlined
                    p-button-success"
                    size="large"
                    ></p-button>
                </div>
                <div *ngIf="!networksList.lgkSnapshotID">
                  <p-button
                  disabled="true"
                  label="watch"
                  icon="pi pi-eye-slash" 
                  styleClass="p-button-danger"
                  size="large"
                  ></p-button>
                </div>

                <!-- Panel ultima cosecha -->
                <div>
                  <p-overlayPanel #op>
                    <ng-template pTemplate="content">
                      <div>
                        <div>
                          <span *ngIf="networksList.lstSnapshotStatus === 'VALID'; else cosechaFallida"class="font-semibold">
                            Cosecha validada
                          </span>
                          <ng-template #cosechaFallida>
                            <span class="font-semibold">Cosecha fallida</span>
                          </ng-template>
                        </div>
                        <div>
                          <i class="pi pi-clock" style="font-size: 12px"></i>
                          <span class="text-sm ml-1">{{networksList.lstSnapshotDate}}</span>
                        </div>
                      </div>
                      <div class="gap-1 align-items-center">

                        <div class="flex align-items-center gap-3 mb-3 mt-3">
                          <p-badge value="Size:"></p-badge>
                          <span class="text-xs font-bold">{{networksList.lstSize}}</span>
                        </div>

                        <div class="flex align-items-center gap-3 mb-3">
                          <p-badge value="Valid:"></p-badge>
                          <span class="text-xs font-bold">{{networksList.lstValidSize}}</span>
                        </div>

                        <div class="flex align-items-center gap-3">
                          <p-badge value="Transformed:"></p-badge>
                          <span class="text-xs font-bold">{{networksList.lstTransformedSize}}</span>
                        </div>
                        
                      </div>
                    </ng-template>
                  </p-overlayPanel>
                  <p-button 
                    (click)="op.toggle($event)"
                    label="{{networksList.lstSnapshotStatus === 'VALID' ? 'Valid' : 'Failed'}}"
                    icon="pi pi-eye" 
                    [styleClass]="'p-button-outlined ' + (networksList.lstSnapshotStatus === 'VALID' ? 'p-button-success' : 'p-button-danger')"

                    size="large"
                    ></p-button>
                </div>
              </div>
            </td>
            <td>
              <p-button
                icon="pi pi-file-edit"
                styleClass=" p-button-text p-button-secondary p-button"
                routerLink="/harvesting-admin/{{networksList.networkID}}"
                  ></p-button>
            </td>
          </tr>
      </ng-template>
  </p-table>
</div>
