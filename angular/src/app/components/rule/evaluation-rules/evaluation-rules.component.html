<div class="modal-title" mat-dialog-title>
  <div>
    <span i18n>Result of the evaluation of rules for "{{ record.identifier }}" record</span>
    <span [ngClass]="[
      'badge',
      'span-record-is-valid',
      record.isValid == true ? 'badge-success' : 'badge-danger'
    ]" i18n>{record.isValid, select, true {Valid record} false {Invalid record}}
    </span>
  </div>

  <div class="icon-legend">
    <mat-icon [inline]="true">cancel</mat-icon>
    <span class="occurrence" i18n>Invalid occurrence</span>
    <mat-icon [inline]="true" class="ml-2">check_circle_outline</mat-icon>
    <span class="occurrence" i18n>Valid occurrence</span>
  </div>
</div>

<mat-dialog-content class="mat-typography">

  <div class="btn-actions">
    <mat-button-toggle-group #toggleFilter (change)="toggleChange($event)" multiple="true" [value]="selectedToggle" name="fontStyle" aria-label="Font Style">
      <mat-button-toggle  [ngClass]="{ 'red' : redToggle}" value="red" i18n>Invalid mandatory rules</mat-button-toggle>
      <mat-button-toggle  [ngClass]="{ 'yellow' : yellowToggle}" value="yellow" i18n>Invalid not mandatory rules</mat-button-toggle>
      <mat-button-toggle  [ngClass]="{ 'green' : greenToggle}" value="green" i18n>Valid rules</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <!-- List invalid rules -->
  <div *ngFor="let obj of record.invalidRulesID">
    <div
      *ngIf="
        record.validOccurrencesByRuleID[obj] ||
        record.invalidOccurrencesByRuleID[obj]
      "
    >
      <mat-card [ngClass]="getRule(obj).mandatory == true ? 'red' : 'yellow'">
        <mat-card-header>
          <mat-card-title>
            <div class="rule-info">
              {{ getRule(obj).name }}
              <mat-icon 
                [inline]="true"
                class="icon-help" 
                matTooltipPosition="right" 
                matTooltip="{{ getRule(obj).description }}">
                help
              </mat-icon>
            </div>
            <span class="span-margin-left" i18n>
              {getRule(obj).mandatory, select, true {Mandatory rule: Yes} false
              {Mandatory rule: No}}
            </span>
          </mat-card-title>
          <mat-card-subtitle>
            <ng-container [ngSwitch]="getRule(obj).quantifier">
              <span *ngSwitchCase="'ZERO_ONLY'" i18n>Zero only</span>
              <span *ngSwitchCase="'ONE_ONLY'" i18n>One only</span>
              <span *ngSwitchCase="'ZERO_OR_MORE'" i18n>Zero or more</span>
              <span *ngSwitchCase="'ONE_OR_MORE'" i18n>One or more</span>
              <span *ngSwitchCase="'ALL'" i18n>All</span>
              <mat-icon 
                class="icon-help"
                [inline]="true"
                i18n-matTooltip 
                matTooltipPosition="right" 
                matTooltip="Number of valid occurrences for a rule to be valid">
                help
              </mat-icon>
            </ng-container>
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="occurrences">
            <!-- List valid ocurrences -->
            <div *ngFor="let x of record.validOccurrencesByRuleID[obj]">
              <div class="icon">
                <i class="material-icons">check_circle_outline</i
                ><span class="occurrence">{{ x }}</span>
              </div>
            </div>
            <!-- List invalid ocurrences -->
            <div *ngFor="let x of record.invalidOccurrencesByRuleID[obj]">
              <div class="icon">
                <i class="material-icons">cancel</i
                ><span class="occurrence">{{ x }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
  <!-- List valid rules -->
  <div *ngFor="let obj of record.validRulesID">
    <div
      *ngIf="
        record.validOccurrencesByRuleID[obj] ||
        record.invalidOccurrencesByRuleID[obj]
      "
    >
      <mat-card class="green record-card">
        <mat-card-header class="record-card-header">
          <mat-card-title class="record-card-title">
            <div class="rule-info">
              {{ getRule(obj).name }}
              <mat-icon 
                [inline]="true"
                class="icon-help" 
                matTooltipPosition="right" 
                matTooltip="{{ getRule(obj).description }}">
                help
              </mat-icon>
            </div>
            <div>
              <span class="span-margin-left" i18n>
                {getRule(obj).mandatory, select, true {Mandatory rule: Yes} false
                {Mandatory rule: No}}
              </span>
            </div>
          </mat-card-title>
          <mat-card-subtitle>
            <ng-container [ngSwitch]="getRule(obj).quantifier">
              <span *ngSwitchCase="'ZERO_ONLY'" i18n>Zero only</span>
              <span *ngSwitchCase="'ONE_ONLY'" i18n>One only</span>
              <span *ngSwitchCase="'ZERO_OR_MORE'" i18n>Zero or more</span>
              <span *ngSwitchCase="'ONE_OR_MORE'" i18n>One or more</span>
              <span *ngSwitchCase="'ALL'" i18n>All</span>
              <mat-icon 
                class="icon-help"
                [inline]="true"
                i18n-matTooltip 
                matTooltipPosition="right" 
                matTooltip="Number of valid occurrences for a rule to be valid">
                help
              </mat-icon>
            </ng-container>
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="occurrences">
            <!-- List valid ocurrences -->
            <div *ngFor="let x of record.validOccurrencesByRuleID[obj]">
              <div class="icon">
                <i class="material-icons">check_circle_outline</i
                ><span class="occurrence">{{ x }}</span>
              </div>
            </div>
            <!-- List invalid ocurrences -->
            <div *ngFor="let x of record.invalidOccurrencesByRuleID[obj]">
              <div class="icon">
                <i class="material-icons">cancel</i
                ><span class="occurrence">{{ x }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button
    mat-dialog-close
    type="button"
    class="btn btn-outline-dark"
    i18n="Button close"
  >
    Close
  </button>
</mat-dialog-actions>
